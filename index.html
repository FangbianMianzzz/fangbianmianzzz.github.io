<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
  <title>厦门和新拉链产品数据中心</title>
  <style>
    :root {
      --primary: #2c7be5;
      --secondary: #6e84a3;
      --success: #00ac69;
      --warning: #f6c343;
      --border-radius: 8px;
      --box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }
    * {
      box-sizing: border-box;
    }
    body {
      font-family: 'Helvetica Neue', Arial, sans-serif;
      margin: 0;
      padding: 15px;
      background: #f5f5f7;
      line-height: 1.5;
      font-size: 14px;
    }
    .container {
      max-width: 1200px;
      margin: 0 auto;
      background: white;
      padding: 20px;
      border-radius: var(--border-radius);
      box-shadow: var(--box-shadow);
    }
    h1 {
      color: var(--primary);
      margin-top: 0;
      font-size: 1.5rem;
    }
    /* 搜索与高级筛选 */
    .search-container {
      margin-bottom: 10px;
    }
    .search-container input {
      width: 100%;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 1rem;
    }
    .filter-group {
      display: flex;
      gap: 10px;
      margin-bottom: 10px;
      flex-wrap: wrap;
    }
    .filter-group select,
    .filter-group input {
      padding: 8px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 0.9rem;
    }
    /* 表格样式 */
    .table-responsive {
      width: 100%;
      overflow-x: auto;
      margin-bottom: 20px;
      -webkit-overflow-scrolling: touch;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      min-width: 600px;
    }
    th, td {
      padding: 12px 10px;
      text-align: left;
      border-bottom: 1px solid #e0e0e0;
    }
    th {
      background-color: var(--primary);
      color: white;
      position: sticky;
      top: 0;
      cursor: pointer;
      user-select: none;
    }
    th.sort-asc::after {
      content: " ▲";
      font-size: 0.8rem;
    }
    th.sort-desc::after {
      content: " ▼";
      font-size: 0.8rem;
    }
    tr:hover {
      background-color: #f8f9fa;
    }
    tr.selected {
      background-color: #e6f0ff;
    }
    .price {
      color: var(--success);
      font-weight: bold;
    }
    /* 计算器样式 */
    .calculator {
      background: #f8f9fa;
      padding: 20px;
      border-radius: var(--border-radius);
      margin-top: 20px;
    }
    .calculator h2 {
      margin-top: 0;
      color: var(--primary);
      font-size: 1.3rem;
    }
    .input-group {
      margin-bottom: 15px;
    }
    label {
      display: block;
      margin-bottom: 5px;
      font-weight: 500;
      color: #555;
    }
    input {
      width: 100%;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 1rem;
    }
    button {
      background: var(--primary);
      color: white;
      border: none;
      padding: 12px;
      border-radius: 4px;
      cursor: pointer;
      width: 100%;
      font-size: 1rem;
      font-weight: 500;
      transition: background 0.2s;
    }
    button:hover {
      background: #1a68d4;
    }
    .result {
      margin-top: 20px;
      padding-top: 15px;
      border-top: 1px solid #eee;
    }
    #totalPrice {
      font-weight: bold;
      font-size: 1.2rem;
      color: var(--primary);
    }
    #calculationDetail {
      color: var(--secondary);
      font-size: 0.9rem;
      margin-top: 5px;
    }
    /* 计算历史记录样式 */
    .history {
      margin-top: 20px;
      padding: 15px;
      background: #fff;
      border: 1px solid #ddd;
      border-radius: var(--border-radius);
      max-height: 200px;
      overflow-y: auto;
    }
    .history h3 {
      margin-top: 0;
      font-size: 1.1rem;
      color: var(--primary);
    }
    .history-item {
      border-bottom: 1px dashed #eee;
      padding: 5px 0;
      font-size: 0.9rem;
    }
    /* 错误提示动画 */
    .error-message {
      color: #dc3545;
      font-size: 0.8rem;
      margin-top: 5px;
      display: none;
    }
    .shake {
      animation: shake 0.5s;
    }
    @keyframes shake {
      0%,100% { transform: translateX(0); }
      25% { transform: translateX(5px); }
      75% { transform: translateX(-5px); }
    }
    /* 模态框样式 */
    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0; top: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.5);
      justify-content: center;
      align-items: center;
    }
    .modal-content {
      background: white;
      padding: 20px;
      border-radius: var(--border-radius);
      width: 90%;
      max-width: 500px;
      position: relative;
    }
    .modal-content img {
      max-width: 100%;
      border-radius: var(--border-radius);
      margin-bottom: 10px;
    }
    .close {
      position: absolute;
      top: 10px;
      right: 15px;
      font-size: 1.5rem;
      cursor: pointer;
      color: #333;
    }
    /* 移动端优化 */
    @media (max-width: 768px) {
      body { padding: 10px; }
      .container { padding: 15px; }
      th, td { padding: 8px 6px; font-size: 0.9rem; }
      .calculator { padding: 15px; }
      input, button { padding: 12px; }
    }
    /* 桌面端优化 */
    @media (min-width: 992px) {
      body { padding: 20px; }
      table { min-width: 100%; }
      th, td { padding: 12px 15px; }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>厦门和新拉链产品数据中心</h1>
    <p>共26款拉链产品</p>

    <!-- 搜索输入框 -->
    <div class="search-container">
      <input type="text" id="searchInput" placeholder="搜索产品，如品名、编号或拉片..." aria-label="搜索产品">
    </div>
    <!-- 高级筛选面板 -->
    <div class="filter-group">
      <select id="filterPullTab" aria-label="筛选拉片类型">
        <option value="">全部拉片类型</option>
        <option value="水滴拉片">水滴拉片</option>
        <option value="剑尾片（免费）">剑尾片（免费）</option>
        <!-- 可根据需要添加更多选项 -->
      </select>
      <input type="number" id="filterMinPrice" placeholder="最低价" aria-label="最低价格">
      <input type="number" id="filterMaxPrice" placeholder="最高价" aria-label="最高价格">
      <button id="filterBtn">筛选</button>
    </div>

    <div class="table-responsive">
      <table id="productTable">
        <thead>
          <tr>
            <th data-sort="id">序号</th>
            <th data-sort="code">编号</th>
            <th data-sort="name">品名</th>
            <th data-sort="pullTab">拉片</th>
            <th data-sort="price">基准价格</th>
            <th data-sort="cmPrice">±1cm价格</th>
          </tr>
        </thead>
        <tbody id="tableBody">
          <!-- 产品数据将在这里动态生成 -->
        </tbody>
      </table>
    </div>

    <div class="calculator">
      <h2>价格计算器</h2>
      <div class="input-group">
        <label>当前产品</label>
        <div id="currentProduct">未选择产品</div>
      </div>
      <div class="input-group">
        <label>基准价格 (30cm)</label>
        <div id="basePrice" class="price">¥0.00</div>
      </div>
      <div class="input-group">
        <label>每厘米价格</label>
        <div id="cmPrice">¥0.0000/cm</div>
      </div>
      <div class="input-group">
        <label>定制长度 (cm)</label>
        <input type="number" id="customLength" min="5" max="300" placeholder="输入5-300之间的数字" aria-label="定制长度">
        <div id="lengthError" class="error-message">请输入有效长度（5-300cm）</div>
      </div>
      <div class="input-group">
        <label>数量</label>
        <input type="number" id="quantity" value="1" min="1" aria-label="产品数量">
      </div>
      <button id="calculateBtn">计算总价</button>
      <div class="result" id="result" style="display: none;">
        <div>总价: <span id="totalPrice" class="price">¥0.0000</span></div>
        <div id="calculationDetail" style="margin-top: 10px; color: #666;"></div>
      </div>
      
      <!-- 计算历史记录区域 -->
      <div class="history" id="history" style="display:none;">
        <h3>计算历史</h3>
        <div id="historyList"></div>
        <button id="exportBtn">导出历史记录</button>
      </div>
    </div>
  </div>

  <!-- 产品详情模态框 -->
  <div id="productModal" class="modal" role="dialog" aria-modal="true">
    <div class="modal-content">
      <span class="close" id="modalClose">&times;</span>
      <h3 id="modalTitle"></h3>
      <img id="modalImage" src="placeholder.jpg" alt="产品图">
      <div id="modalSpecs"></div>
    </div>
  </div>

  <script>
    // 示例产品数据（可扩展）
    const products = [
      { id: 1, code: "FB23020002", name: "5#隐形拉链，水滴拉片", pullTab: "水滴拉片", price: 1.93, cmPrice: 0.02, specs: "材质：尼龙；适用：服装" },
      { id: 2, code: "FB23020003", name: "5#金属闭口白金", pullTab: "与狼共舞圆环(0.5)0.8", price: 3.60, cmPrice: 0.06, specs: "材质：金属；适用：包袋" },
      { id: 3, code: "FB23020004", name: "4#尼龙背拉闭口", pullTab: "葫芦片（免费）", price: 1.00, cmPrice: 0.01, specs: "材质：尼龙；适用：服装" }
      // 其它产品……
    ];

    // 全局状态变量
    let selectedProduct = null;
    let filteredProducts = [...products];
    let currentSort = { column: null, order: 'asc' };
    let calculationHistory = JSON.parse(localStorage.getItem('calcHistory')) || [];

    // 渲染表格
    function renderTable() {
      const tbody = document.getElementById('tableBody');
      tbody.innerHTML = '';
      filteredProducts.forEach(product => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${product.id}</td>
          <td>${product.code}</td>
          <td>${product.name}</td>
          <td>${product.pullTab}</td>
          <td class="price">¥${product.price.toFixed(2)}</td>
          <td>¥${product.cmPrice.toFixed(4)}</td>
        `;
        // 点击行既选择产品又显示详情模态框
        row.addEventListener('click', () => {
          selectProduct(product);
          showProductModal(product);
        });
        tbody.appendChild(row);
      });
      if(filteredProducts.length > 0 && !selectedProduct){
        selectProduct(filteredProducts[0]);
      }
    }

    // 初始化表格
    function initTable() {
      filteredProducts = [...products];
      renderTable();
    }

    // 搜索和高级筛选
    function filterTable() {
      const query = document.getElementById('searchInput').value.toLowerCase();
      const filterPullTab = document.getElementById('filterPullTab').value;
      const minPrice = parseFloat(document.getElementById('filterMinPrice').value) || 0;
      const maxPrice = parseFloat(document.getElementById('filterMaxPrice').value) || Infinity;
      filteredProducts = products.filter(p =>
        (p.name.toLowerCase().includes(query) || p.code.toLowerCase().includes(query) || p.pullTab.toLowerCase().includes(query)) &&
        (filterPullTab === "" || p.pullTab.includes(filterPullTab)) &&
        (p.price >= minPrice && p.price <= maxPrice)
      );
      if(currentSort.column){
        sortProducts(currentSort.column, currentSort.order, false);
      } else {
        renderTable();
      }
    }

    // 排序功能
    function sortProducts(column, order, render = true) {
      currentSort = { column, order };
      filteredProducts.sort((a, b) => {
        if(a[column] < b[column]) return order === 'asc' ? -1 : 1;
        if(a[column] > b[column]) return order === 'asc' ? 1 : -1;
        return 0;
      });
      if(render) renderTable();
    }

    // 初始化排序
    function initSort() {
      const headers = document.querySelectorAll('#productTable th');
      headers.forEach(th => {
        th.addEventListener('click', function() {
          const column = this.getAttribute('data-sort');
          let order = 'asc';
          if(currentSort.column === column && currentSort.order === 'asc'){
            order = 'desc';
          }
          headers.forEach(h => { h.classList.remove('sort-asc', 'sort-desc'); });
          this.classList.add(order === 'asc' ? 'sort-asc' : 'sort-desc');
          sortProducts(column, order);
        });
      });
    }

    // 选择产品，更新计算器显示
    function selectProduct(product) {
      document.querySelectorAll('#tableBody tr').forEach(row => row.classList.remove('selected'));
      const rows = document.querySelectorAll('#tableBody tr');
      rows.forEach((row, index) => {
        if(filteredProducts[index].id === product.id){
          row.classList.add('selected');
        }
      });
      selectedProduct = product;
      updateCalculatorDisplay();
      document.querySelector('.calculator').scrollIntoView({ behavior: 'smooth', block: 'nearest' });
    }

    // 更新计算器显示
    function updateCalculatorDisplay() {
      if (selectedProduct) {
        document.getElementById('currentProduct').textContent = selectedProduct.name;
        document.getElementById('basePrice').textContent = `¥${selectedProduct.price.toFixed(2)}`;
        document.getElementById('cmPrice').textContent = `¥${selectedProduct.cmPrice.toFixed(4)}/cm`;
      }
    }

    // 计算价格并记录历史（含数量）
    function calculatePrice() {
      if (!selectedProduct) {
        alert('请先在表格中选择产品');
        return;
      }
      const lengthInput = document.getElementById('customLength');
      const quantityInput = document.getElementById('quantity');
      const length = parseFloat(lengthInput.value);
      const quantity = parseInt(quantityInput.value);
      if (isNaN(length) || length < 5 || length > 300) {
        const errorEl = document.getElementById('lengthError');
        errorEl.style.display = 'block';
        errorEl.classList.add('shake');
        setTimeout(() => { errorEl.classList.remove('shake'); }, 500);
        lengthInput.focus();
        return;
      } else {
        document.getElementById('lengthError').style.display = 'none';
      }
      const diff = length - 30;
      const adjustedDiff = Math.round(diff / 0.0064) * 0.0064;
      let unitPrice = selectedProduct.price + (adjustedDiff * selectedProduct.cmPrice);
      const totalPrice = unitPrice * quantity;
      document.getElementById('totalPrice').textContent = `¥${totalPrice.toFixed(4)}`;
      const detailText = `计算公式: (¥${selectedProduct.price.toFixed(2)} + ${adjustedDiff >= 0 ? '+' : '-'} ${Math.abs(adjustedDiff)}cm×¥${selectedProduct.cmPrice.toFixed(4)}/cm) × ${quantity} = ¥${totalPrice.toFixed(4)}`;
      document.getElementById('calculationDetail').innerHTML = detailText;
      document.getElementById('result').style.display = 'block';
      document.getElementById('result').scrollIntoView({ behavior: 'smooth', block: 'nearest' });
      // 保存记录并更新历史
      saveCalculationHistory({
        timestamp: new Date().toLocaleString(),
        product: selectedProduct.name,
        customLength: length,
        quantity,
        totalPrice: totalPrice.toFixed(4),
        detail: detailText
      });
    }

    // 保存计算历史记录到 localStorage 并显示
    function saveCalculationHistory(record) {
      calculationHistory.unshift(record);
      localStorage.setItem('calcHistory', JSON.stringify(calculationHistory));
      renderHistory();
    }
    function renderHistory() {
      const historyDiv = document.getElementById('history');
      const historyList = document.getElementById('historyList');
      historyList.innerHTML = '';
      calculationHistory.forEach(item => {
        const div = document.createElement('div');
        div.className = 'history-item';
        div.innerHTML = `<strong>${item.timestamp}</strong> - ${item.product} | 长度: ${item.customLength}cm × ${item.quantity} | 总价: ¥${item.totalPrice}<br>${item.detail}`;
        historyList.appendChild(div);
      });
      historyDiv.style.display = calculationHistory.length > 0 ? 'block' : 'none';
    }

    // 导出历史记录为CSV
    function exportHistory() {
      if(calculationHistory.length === 0) return;
      let csvContent = "data:text/csv;charset=utf-8,";
      csvContent += "时间,产品,定制长度,数量,总价,计算详情\n";
      calculationHistory.forEach(item => {
        csvContent += `"${item.timestamp}","${item.product}","${item.customLength}","${item.quantity}","${item.totalPrice}","${item.detail}"\n`;
      });
      const encodedUri = encodeURI(csvContent);
      const link = document.createElement("a");
      link.setAttribute("href", encodedUri);
      link.setAttribute("download", "calculation_history.csv");
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    }

    // 产品详情模态框显示
    function showProductModal(product) {
      const modal = document.getElementById('productModal');
      document.getElementById('modalTitle').textContent = product.name;
      // 使用产品图片，若无则用占位图
      document.getElementById('modalImage').src = product.image || 'https://via.placeholder.com/200';
      document.getElementById('modalSpecs').textContent = product.specs || '暂无详细信息';
      modal.style.display = 'flex';
    }
    // 模态框关闭
    function closeModal() {
      document.getElementById('productModal').style.display = 'none';
    }

    // 初始化页面
    document.addEventListener('DOMContentLoaded', () => {
      initTable();
      initSort();
      renderHistory();
      document.getElementById('calculateBtn').addEventListener('click', calculatePrice);
      document.getElementById('customLength').addEventListener('input', function () {
        if (this.value && selectedProduct) {
          calculatePrice();
        } else {
          document.getElementById('result').style.display = 'none';
        }
      });
      document.getElementById('searchInput').addEventListener('input', filterTable);
      document.getElementById('filterBtn').addEventListener('click', filterTable);
      document.getElementById('exportBtn').addEventListener('click', exportHistory);
      document.getElementById('modalClose').addEventListener('click', closeModal);
      window.addEventListener('click', function(event) {
        const modal = document.getElementById('productModal');
        if (event.target === modal) {
          closeModal();
        }
      });
    });
  </script>
</body>
</html>
